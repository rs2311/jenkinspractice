{##### Type5 Routes Classic L3 ######}
{##### Applicable for Leaf #####}

{% for entry in Devices[SW]['customers'] %}
vrf instance {{ entry['cust_name'] }}
   rd {{ entry['cust_id'] }}:{{ Devices[SW]['device_id'] }}
!
ip routing vrf {{ entry['cust_name'] }}
!
interface loopback{{ entry['cust_id'] }}
   vrf forwarding {{ entry['cust_name'] }}
   ip address {{ entry['l3_loopback_subnet'] | ipaddr(Devices[SW]['device_id']) | ipaddr('address') }}/32
!
interface Vxlan1
   vxlan vrf {{ entry['cust_name'] }} vni {{ entry['l3_vni'] }}

{% endfor %}


{##### Type5 Routes Classic L3 BGP Configuration #####}
{##### Applicable for Leaf #####}
{% for entry in Devices[SW]['customers'] %}

router bgp 65000

   vrf {{ entry['cust_name'] }}
      rd {{ entry['cust_id'] }}:{{ Devices[SW]['device_id'] }}
      route-target import evpn {{ entry['cust_id'] }}:{{ entry['cust_id'] }}
      route-target export evpn {{ entry['cust_id'] }}:{{ entry['cust_id'] }}
      redistribute connected
      exit
   exit
{% endfor %}

{##### Type2 Routes VLAN Creation #####}
{##### Applicable for leaf #####}

{% for entry in Devices[SW]['customers'] %}
{% for vlan_entry in entry['type2_routes'] %}
!
vlan {{ vlan_entry['vlan'] }}
   name {{ vlan_entry['name'] }}
!
interface vlan {{ vlan_entry['vlan'] }}
   vrf forwarding {{ entry['cust_name'] }}
   ip address virtual {{ vlan_entry['subnet'] | ipaddr(1) }}
!
{% endfor %}
{% endfor %}

!
{##### Type2 Routes Vxlan VNI Entry #####}
{##### Applicable for leaf #####}

{% for entry in Devices[SW]['customers'] %}
{% for vlan_entry in entry['type2_routes'] %}
!
interface Vxlan1
   vxlan vlan {{ vlan_entry['vlan'] }} vni {{ vlan_entry['l2_vni'] }}
!
{% endfor %}
{% endfor %}
!

{##### Type2 Routes BGP Configuration #####}
{##### Applicable for leaf #####}
!
{% for entry in Devices[SW]['customers'] %}
{% for vlan_entry in entry['type2_routes'] %}
!
router bgp 65000
!
   vlan {{ vlan_entry['vlan'] }}
   rd {{ vlan_entry['vlan'] }}:{{ Devices[SW]['device_id'] }}
   route-target import {{ vlan_entry['l2_vni'] }}:{{ vlan_entry['vlan'] }}
   route-target export {{ vlan_entry['l2_vni'] }}:{{ vlan_entry['vlan'] }}
   redistribute learned
   exit
!
{% endfor %}
{% endfor %}
