
{##### Base VXLAN Config #####}
{##### Applicable for Leaf #####}
int vxlan 1
   vxlan source-int lo 1
   vxlan udp-port 4789
!
ip virtual-router mac-address 0c:fd:01:01:01:01
!


{########## Type5 Routes Classic L3 ########}
{############## Applicable for Leaf ################}

{% for entry in Devices[SW]['customers'] %}

vrf instance {{ entry['cust_name'] }}
   rd {{ entry['cust_id'] }}:{{ Devices[SW]['device_id'] }}
!
ip routing vrf {{ entry['cust_name'] }}
!
interface loopback{{ entry['cust_id'] }}
   vrf forwarding {{ entry['cust_name'] }}
   ip address {{ entry['l3_loopback_ip'] }}
!
interface Vxlan1
   vxlan vrf {{ entry['cust_name'] }} vni {{ entry['l3_vni'] }}
!
router bgp 65000
!
   vrf {{ entry['cust_name'] }}
   rd {{ entry['cust_id'] }}:{{ Devices[SW]['device_id'] }}
   route-target import evpn {{ entry['cust_id'] }}:{{ entry['cust_id'] }}
   route-target export evpn {{ entry['cust_id'] }}:{{ entry['cust_id'] }}
   redistribute connected
      address-family ipv4
      exit
   exit
exit
{% endfor %}
!

{##### Type5 Routes ########}
{##### Restricted to Leaf Pair  ########}
{##### ****HSRP Config to be added  ########}
{##### VRF vni is sufficent no MAC VNI  ########}
{##### As long as redistribute connected is configured in BGP under VRF no spefic advertisment is required  ########}
{##### Applicable for Leaf###############}

{% for entry in Devices[SW]['customers'] %}
{% for vlan_entry in entry['type5_routes'] %}
!
vlan {{ vlan_entry['vlan'] }}
   name {{ vlan_entry['name'] }}
!
interface vlan {{ vlan_entry['vlan'] }}
   vrf forwarding {{ entry['cust_name'] }}
   ip address {{ vlan_entry['subnet'] | ipaddr(1) }}
!
{% endfor %}
{% endfor %}
!
{# Type2 Routes DataCenter Wide Rack Specfic #}
{##### vni is applicable per VLAN  ########}
{##### Applicable for Leaf###############}

{% for entry in Devices[SW]['customers'] %}
{% for vlan_entry in entry['type2_routes'] %}
!
vlan {{ vlan_entry['vlan'] }}
   name {{ vlan_entry['name'] }}
!
interface vlan {{ vlan_entry['vlan'] }}
   vrf forwarding {{ entry['cust_name'] }}
   ip address virtual {{ vlan_entry['subnet'] | ipaddr(1) }}
!
router bgp 65000
!
   vlan {{ vlan_entry['vlan'] }}
   rd {{ vlan_entry['vlan'] }}:{{ Devices[SW]['device_id'] }}
   route-target import {{ vlan_entry['l2_vni'] }}:{{ vlan_entry['vlan'] }}
   route-target export {{ vlan_entry['l2_vni'] }}:{{ vlan_entry['vlan'] }}
   redistribute learned
   exit
   exit
!
interface Vxlan1
   vxlan vlan {{ vlan_entry['vlan'] }} vni {{ vlan_entry['l2_vni'] }}
!
{% endfor %}
{% endfor %}
!

{#### Ethernet Configuration towards Host Network ####}
{#### Applicable for Leaf ####}
!
{% for entry in Devices[SW]['host_ethernet'] %}
interface eth {{ entry['int_num'] }}
   switchport
   switchport mode trunk
   des {{ entry['des'] }}
{% endfor %}
!
